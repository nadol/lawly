---
const code = Astro.url.searchParams.get('code');

if (!code) {
  return Astro.redirect('/login?error=oauth');
}

const { error } = await Astro.locals.supabase.auth.exchangeCodeForSession(code);

if (error) {
  console.error('OAuth callback error:', error);
  return Astro.redirect('/login?error=oauth');
}

return Astro.redirect('/welcome');
---
