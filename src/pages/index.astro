---
import DashboardLayout from "../layouts/DashboardLayout.astro";
import { DashboardMain } from "../components/dashboard";
import { getProfileByUserId } from "../lib/services/profile.service";

// Auth check is handled by DashboardLayout, but we need user for profile fetch
const { data: { user } } = await Astro.locals.supabase.auth.getUser();

// Fetch profile to check welcome state
let initialHasSeenWelcome = false;
if (user) {
  try {
    const profile = await getProfileByUserId(Astro.locals.supabase, user.id);
    if (profile) {
      initialHasSeenWelcome = profile.has_seen_welcome;
    }
  } catch (error) {
    console.warn('Failed to fetch profile, defaulting to show welcome:', error);
    // Default to false (show welcome) on error for better UX
    initialHasSeenWelcome = false;
  }
}
---

<DashboardLayout title="Lawly - Dashboard">
  <DashboardMain
    client:load
    initialHasSeenWelcome={initialHasSeenWelcome}
  />
</DashboardLayout>
